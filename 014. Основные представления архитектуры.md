## Основные представления архитектуры

**Основные разделы:** <br/>
[Функциональное представление архитектуры](#Функциональное-представление-архитектуры)<br/>
[Информационное представление архитектуры](#Информационное-представление-архитектуры)<br/>
[Многозадачность (concurrency)](#Многозадачность-concurrency)<br/>
[Инфраструктурное представление архитектуры](#Инфраструктурное-представление-архитектуры)<br/>
[Безопасность - представление архитектуры](#безопасность---представление-архитектуры)<br/>
 <br/>

### Функциональное представление архитектуры
Ниже представлены функциональные задачи ключевых сервисов, реализация которых запланирована в MVP версии приложения: 

<image src="/images/Представления архитектуры/Функциональное представление архитектуры.png" alt="Функциональное представление архитектуры" width="600">
<br/> <br/>

### Информационное представление архитектуры
Ниже представлена модель данных. Ключевые информационные объекты и их взаимодействия:

<image src="/images/Представления архитектуры/Информационное представление архитектуры.png" alt="Информационное представление архитектуры" width="600">
 <br/> <br/>

### Многозадачность (concurrency)
**Проблематика:** Публикация и презентация новой коллекции товаров в каталоге приведет к высокому спросу на просмотр каталога и множество заказов в короткий период времени. 

Для обеспечения пользователей актуальным наличием предлагаю использовать асинхронный MQ обмен событиями об изменениях в позициях, чтобы снизить количество расхождений в стоках.

Для защиты от случаев, когда одна позиция может оказаться в нескольких одновременно оформляемых заказах, предлагаю использовать процесс резервирование напрямую в сервисе Склад со стороны сервиса Заказ, после оформления заказа.
Так как в первый год работы сервиса не планируются использовать реплики БД, в случае использования единой базы данных с уровнем изоляции Serializable,  создание двух резервов на одну товарную позицию невозможно. 

<image src="/images/Представления архитектуры/Многозадачность (concurrency).png" alt="Многозадачность (concurrency)">
 <br/> <br/>

### Инфраструктурное представление архитектуры

#### Инфраструктурное представление архитектуры для MVP
Для реализации первой версии MVP потребуется 6 виртуальных серверов (VPS), объединенных в единый контур (VPN). 
Ориентир параметров производительности серверов 
- для работы сервисов: 8CPU, 16gb Memory, 200GB SSD
- для работы базы данных: 4CPU, 8gb Memory, 500GB SSD, 500GB HDD<br/>

В рамках запуска MVP все сервисы и БД будут работать в единичном экземпляре в рамках одного ЦОД. 
В качестве БД: PostgreSQL
Язык разработки сервисов определяется непосредственно командой реализации.

<image src="/images/Представления архитектуры/Инфраструктурное представление архитектуры для MVP.png" alt="Инфраструктурное представление архитектуры для MVP">
  
#### Инфраструктурное представление архитектуры (развитие)
Далее с ростом количества пользователей и с целью повышения отказоустойчивости и производительности предлогаю:
1) Использование отказоустойчивого Load Balancer от одного из облачных провайдеров
2) Развертывание двух инстансов Nginx + GetWay, куда направляет пользователей Load Balancer методом Round Robin
3) Использование Kubernetes для реализации автоматического масштабирования ресурсов работы сервисов
4) Использование одну дополнительной реплики каждой из БД. Для обеспечения синхронизации использовать кластер corosync и управление ресурсами и трафиком от клиентов pacemaker.
5) Для каждой БД предусмотреть пространство для записи архивлогов, хранения полных и инкрементных dump 

<image src="/images/Представления архитектуры/Инфраструктурное представление архитектуры (развитие).png" alt="Инфраструктурное представление архитектуры (развитие)">
 <br/> <br/>

### Безопасность - представление архитектуры
Для обеспечения безопасности пользовательских данных и приложения в целом: 
1) Использовать HTTPS при работе API всех сервисов, и даже закрытых внутри контура 
2) Авторизация по протоколу OAuth 2.0 с внешним Authorization Server (yandex/google/vk)
3) Закрытый контур (VPN) для всей инфраструктуры, отдельная подсеть для групп сервисов, доступ в контур только через конфигурируемый Gateway
4) Отсутствие прямого доступа Front-end к сервису “клиенты” по API, только через сервис Getway
5) Закрытие внутренних API для вызова их из сети интернет
6) Отработка Топ10 векторов атак для каждого  API
7) Шифрование конфид-данных
8) Реализовать Role-based access control (RBAC)

<image src="/images/Представления архитектуры/Безопасность - представление архитектуры.png" alt="Безопасность - представление архитектуры">


